<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>File Upload</title>
    <!-- Bootstrap CSS Toolkit styles -->
    <link rel="stylesheet" href="http://blueimp.github.com/cdn/css/bootstrap.min.css">
    <!-- Bootstrap styles for responsive website layout, supporting different screen sizes -->
    <link rel="stylesheet" href="http://blueimp.github.com/cdn/css/bootstrap-responsive.min.css">
    <!-- Bootstrap CSS fixes for IE6 -->
    <!--[if lt IE 7]><link rel="stylesheet" href="http://blueimp.github.com/cdn/css/bootstrap-ie6.min.css"><![endif]-->
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <%= stylesheet_link_tag "jquery.fileupload-ui.css" %>
    <!-- Shim to make HTML5 elements usable in older Internet Explorer versions -->
    <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <style type="text/css">
        #file_upload_progress {
            background: url(<%= asset_path("uploads/progressbar.gif") %>);
        }

        #file_upload_progress  {
            display: none;
            width: 150px;
            height: 15px;
        }
    </style>
  </head>
  <body>
    <div class="container">
      <br>

      <!-- The file upload form used as target for the file upload widget -->
      <!-- <form id="fileupload" action="/uploads" method="POST" enctype="multipart/form-data"> -->
      <%= form_for current_user.uploads.build, :html => { :id => "fileupload", :multipart => true } do |f| %>
        <!-- <input name="upload[user_id]" type="hidden" value= <%= current_user.id %> /> -->
        <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
        <div class="row fileupload-buttonbar">
          <div class="span7">
            <!-- The fileinput-button span is used to style the file input field as button -->
            <span class="btn btn-success fileinput-button">
              <i class="icon-plus icon-white"></i>
              <span>Add files...</span>
              <%= file_field_tag 'upload[picture]', :multiple => true %>
              <!-- <div>Upload files</div> -->
            </span>
            <button type="submit" class="btn btn-primary start">
              <i class="icon-upload icon-white"></i>
              <span>Start upload</span>
            </button>
            <button type="reset" class="btn btn-warning cancel">
              <i class="icon-ban-circle icon-white"></i>
              <span>Cancel upload</span>
            </button>
            <button type="button" class="btn btn-danger delete">
              <i class="icon-trash icon-white"></i>
              <span>Delete</span>
            </button>
            <input type="checkbox" class="toggle">
          </div>
          <!-- The global progress information -->
          <div class="span5 fileupload-progress fade">
            <!-- The global progress bar -->
            <div class="progress progress-success progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
              <div class="bar" style="width:0%;"></div>
            </div>
            <!-- The extended global progress information -->
            <div class="progress-extended">&nbsp;</div>
          </div>
        </div>
        <!-- The loading indicator is shown during file processing -->
        <div class="fileupload-loading"></div>
        <div id="file_upload_progress"></div>
        <br>
        <!-- The table listing the files available for upload/download -->
        <table role="presentation" class="table table-striped"><tbody class="files" data-toggle="modal-gallery" data-target="#modal-gallery"></tbody></table>
      <% end %>
      <br>
    </div>
    <!-- modal-gallery is the modal dialog used for the image gallery -->

    <table id='doneFile' role="presentation" class="table table-striped">
        <tbody class="files" data-toggle="modal-gallery" data-target="#modal-gallery">
        </tbody>
    </table>


    <!-- The template to display files available for upload -->
    <!-- The main application script -->
    <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
    <%= javascript_include_tag "jquery.ui.widget.js" %>
    <%= javascript_include_tag "jquery.iframe-transport.js" %>
    <%= javascript_include_tag "jquery.fileupload.js" %>
    <script>
      $(function () {
        function d(b){
          if ( isNaN(b))
          return;
          dws=['b','Kb','Mb'];
          for(i=0;i<3;i++){
            dw=dws[i];
            if (b<1024) break;
            b=b/1024;
          }
          return b.toFixed(2)+dw;
        };
        $('#fileupload').fileupload({
          done: function (e, data) {
            $("#doneFile>tbody").append('<tr class="template-upload fade in"> <td class="preview"><span class="fade in"><canvas width="80" height="50"></canvas></span></td> <td class="name"><span>'+data.result.name+'</span></td> <td class="size"><span>'+d(data.result.size)+'</span></td> <td class="progess"><span>100 %</span></td> </tr>');
          },
          start: function (e) {
            console.log("starting");
            $("#file_upload_progress").fadeIn();
          },
          stop:function (e) {
            $("#file_upload_progress").fadeOut();
          },

        });
      });


    </script>
    <!-- The XDomainRequest Transport is included for cross-domain file deletion for IE8+ -->
    <!--[if gte IE 8]><script src="js/cors/jquery.xdr-transport.js"></script><![endif]-->
  </body> 
</html>

